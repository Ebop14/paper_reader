<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Reader</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <h1>Paper Reader</h1>
        <p class="subtitle">Upload papers, generate video scripts & voiceover</p>
    </header>

    <main>
        <!-- Left Panel: Paper Management -->
        <section class="panel" id="panel-papers">
            <h2>Papers</h2>
            <div class="upload-zone" id="pdf-drop">
                <input type="file" id="pdf-input" accept=".pdf" hidden>
                <button class="btn btn-primary" onclick="document.getElementById('pdf-input').click()">
                    Upload PDF
                </button>
                <span class="upload-hint">or drag & drop</span>
            </div>
            <ul id="paper-list" class="paper-list"></ul>
        </section>

        <!-- Center Panel: Pipeline + Script -->
        <section class="panel" id="panel-text">
            <div class="panel-header">
                <h2 id="text-title">Select a paper</h2>
                <div class="pipeline-controls" id="pipeline-controls" style="display:none">
                    <div class="control-row">
                        <label for="voice-select">Voice</label>
                        <select id="voice-select">
                            <option value="serena">Serena</option>
                            <option value="vivian">Vivian</option>
                            <option value="ryan">Ryan</option>
                            <option value="aiden">Aiden</option>
                            <option value="eric">Eric</option>
                            <option value="dylan">Dylan</option>
                            <option value="sohee">Sohee</option>
                            <option value="ono_anna">Ono Anna</option>
                            <option value="uncle_fu">Uncle Fu</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <label for="tts-speed">Speed</label>
                        <input type="range" id="tts-speed" min="0.5" max="2.0" step="0.1" value="1.0">
                        <span id="tts-speed-val">1.0x</span>
                    </div>
                    <button class="btn btn-primary" id="btn-generate">Generate Video</button>
                    <button class="btn" id="btn-reannotate" style="display:none">Regenerate Animations</button>
                    <button class="btn" id="btn-render" style="display:none">Re-render Video</button>
                </div>
            </div>

            <!-- Pipeline Stage Indicator -->
            <div class="pipeline-stages" id="pipeline-stages" style="display:none">
                <div class="stage" data-stage="loading">
                    <div class="stage-dot"></div>
                    <span>Loading</span>
                </div>
                <div class="stage-connector"></div>
                <div class="stage" data-stage="scripting">
                    <div class="stage-dot"></div>
                    <span>Scripting</span>
                </div>
                <div class="stage-connector"></div>
                <div class="stage" data-stage="annotating">
                    <div class="stage-dot"></div>
                    <span>Annotating</span>
                </div>
                <div class="stage-connector"></div>
                <div class="stage" data-stage="voiceover">
                    <div class="stage-dot"></div>
                    <span>Voiceover</span>
                </div>
                <div class="stage-connector"></div>
                <div class="stage" data-stage="animation">
                    <div class="stage-dot"></div>
                    <span>Animation</span>
                </div>
                <div class="stage-connector"></div>
                <div class="stage" data-stage="compositing">
                    <div class="stage-dot"></div>
                    <span>Compositing</span>
                </div>
                <div class="stage-connector"></div>
                <div class="stage" data-stage="done">
                    <div class="stage-dot"></div>
                    <span>Done</span>
                </div>
            </div>

            <div class="progress-bar" id="pipeline-progress" style="display:none">
                <div class="progress-fill" id="pipeline-progress-fill"></div>
                <span class="progress-label" id="pipeline-progress-label"></span>
            </div>

            <div id="text-content" class="text-content">
                <p class="placeholder">Upload a PDF to get started</p>
            </div>
        </section>

        <!-- Right Panel: Player -->
        <section class="panel" id="panel-audio">
            <h2>Player</h2>

            <div id="player" style="display:none">
                <div class="player-controls">
                    <button class="btn btn-icon" id="btn-prev" title="Previous segment">&#9664;&#9664;</button>
                    <button class="btn btn-icon btn-play" id="btn-play" title="Play">&#9654;</button>
                    <button class="btn btn-icon" id="btn-next" title="Next segment">&#9654;&#9654;</button>
                </div>
                <div class="chunk-indicator">
                    <span id="chunk-current">0</span> / <span id="chunk-total">0</span>
                </div>

                <div class="volume-controls">
                    <div class="volume-row">
                        <label>Volume</label>
                        <input type="range" id="vol-speech" min="0" max="1" step="0.05" value="1">
                    </div>
                </div>
            </div>

            <!-- Segment Animation Browser -->
            <div id="animation-browser" style="display:none">
                <h3>Segment Animations</h3>
                <video id="animation-player" controls class="video-player"></video>
                <div class="animation-nav">
                    <button class="btn btn-icon" id="btn-anim-prev" title="Previous animation">&#9664;&#9664;</button>
                    <span class="animation-indicator">
                        <span id="anim-current">0</span> / <span id="anim-total">0</span>
                    </span>
                    <button class="btn btn-icon" id="btn-anim-next" title="Next animation">&#9654;&#9654;</button>
                </div>
                <div id="anim-segment-title" class="anim-segment-title"></div>
            </div>

            <!-- Video Player -->
            <div id="video-player-section" style="display:none">
                <h3>Video</h3>
                <video id="video-player" controls class="video-player"></video>
            </div>

            <!-- Export -->
            <div class="export-section" id="export-section" style="display:none">
                <button class="btn btn-secondary" id="btn-export">Download Voiceover</button>
                <button class="btn btn-secondary" id="btn-export-video" style="display:none; margin-top:0.5rem">Download Video</button>
            </div>
        </section>
    </main>

    <audio id="audio-speech" preload="auto"></audio>
    <audio id="audio-music" preload="auto" loop></audio>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/audio-mixer.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
